//
// new queries & existing queries processes
//
- new_queries = process_new_query_data(all_data, selected, compared, true)
- existing_queries = process_new_query_data(all_data, selected, compared, false)

hr
h3 Overview
= render partial: "analitics/table/overview", locals: {new_queries: new_queries, existing_queries: existing_queries}

//
// queries process for keywords rankings
//
- queries_selected = selected.map{|query| query.attributes.merge(type: 'selected')}
- queries_compared = compared.map{|query| query.attributes.merge(type: 'compared')}
- queries_grouped  = (queries_selected + queries_compared).group_by { |data| data['query'] }
- queries          = process_queries(queries_grouped)

hr
h3 Top Keywords (top 10 based on clicks)
- top_keywords = queries.sort_by { |q| q[:all_clicks] }.reverse.take(10)
= render partial: "analitics/table/list", locals: {analitics: top_keywords}

hr
h3 New Keywords (top 10 based on impressions)
- new_keywords = queries.sort_by { |q| q[:all_impressions] }.reverse.take(10)
= render partial: "analitics/table/list", locals: {analitics: new_keywords}

hr
h3 Keywords Dissapeared (top 10 based on impressions from past period)
- keywords_dissapeared = queries.sort_by { |q| q[:s_impressions] }.reverse.take(10)
= render partial: "analitics/table/list", locals: {analitics: keywords_dissapeared}

hr
h3 Improved Rangkings
- improved_rangkings = queries.select {|q| q[:all_impressions] >= 100 }.sort_by { |r| r[:avg_position] }.reverse.take(10)
= render partial: "analitics/table/list", locals: {analitics: improved_rangkings}

hr
h3 Lost Rangkings
- improved_rangkings = queries.select {|q| q[:all_impressions] <= 100 }.sort_by { |r| r[:avg_position] }.reverse.take(10)
= render partial: "analitics/table/list", locals: {analitics: improved_rangkings}

//
// still in progress
//
hr
h3 CTR
- selected_ctr = queries.select {|q| q[:selected_impressions] > 100 }.sort_by { |r| r[:ctr] }
- compared_ctr = queries.select {|q| q[:compared_impressions] > 100 }.sort_by { |r| r[:ctr] }
- combined_ctr = selected_ctr + compared_ctr
= render partial: "analitics/table/list_ctr", locals: {selected_analitics: selected_ctr, compared_analitics: compared_ctr, combined_analitics: combined_ctr}